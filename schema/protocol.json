{
  "$defs": {
    "AddReactionRequest": {
      "additionalProperties": false,
      "properties": {
        "emoji": {
          "description": "Emoji character(s) to react with",
          "type": "string"
        },
        "message_id": {
          "description": "ID of the message to react to",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "emoji"
      ],
      "type": "object"
    },
    "CreateDMRequest": {
      "additionalProperties": false,
      "properties": {
        "user_ids": {
          "description": "User IDs to start DM with (not including self)",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "type": "array"
        }
      },
      "required": [
        "user_ids"
      ],
      "type": "object"
    },
    "CreateDMResponse": {
      "additionalProperties": false,
      "properties": {
        "created": {
          "description": "True if a new DM was created (false if existing DM was found)",
          "type": "boolean"
        },
        "room": {
          "$ref": "#/$defs/Room",
          "description": "The DM room (existing or newly created)"
        }
      },
      "required": [
        "room",
        "created"
      ],
      "type": "object"
    },
    "CreateRoomRequest": {
      "additionalProperties": false,
      "properties": {
        "is_private": {
          "description": "Whether the room is private (invite-only)",
          "type": "boolean"
        },
        "name": {
          "description": "Room display name",
          "maxLength": 80,
          "minLength": 1,
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "type": "object"
    },
    "CreateRoomResponse": {
      "additionalProperties": false,
      "properties": {
        "room": {
          "$ref": "#/$defs/Room",
          "description": "The newly created room"
        }
      },
      "required": [
        "room"
      ],
      "type": "object"
    },
    "DeleteMessageRequest": {
      "additionalProperties": false,
      "properties": {
        "message_id": {
          "description": "ID of the message to delete",
          "type": "string"
        }
      },
      "required": [
        "message_id"
      ],
      "type": "object"
    },
    "EditMessageRequest": {
      "additionalProperties": false,
      "properties": {
        "body": {
          "description": "New message body",
          "minLength": 1,
          "type": "string"
        },
        "message_id": {
          "description": "ID of the message to edit",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "body"
      ],
      "type": "object"
    },
    "Envelope": {
      "additionalProperties": false,
      "properties": {
        "data": {
          "description": "Type-specific payload"
        },
        "type": {
          "description": "Message type identifier",
          "type": "string"
        }
      },
      "required": [
        "type",
        "data"
      ],
      "type": "object"
    },
    "ErrorResponse": {
      "additionalProperties": false,
      "properties": {
        "message": {
          "description": "Human-readable error message",
          "type": "string"
        }
      },
      "required": [
        "message"
      ],
      "type": "object"
    },
    "GetMessageContextRequest": {
      "additionalProperties": false,
      "properties": {
        "message_id": {
          "description": "ID of the message to get context for",
          "type": "string"
        }
      },
      "required": [
        "message_id"
      ],
      "type": "object"
    },
    "GetMessageContextResponse": {
      "additionalProperties": false,
      "properties": {
        "message": {
          "$ref": "#/$defs/Message",
          "description": "The requested message"
        },
        "room_id": {
          "description": "Room the message belongs to",
          "type": "string"
        }
      },
      "required": [
        "message",
        "room_id"
      ],
      "type": "object"
    },
    "GetProfileRequest": {
      "additionalProperties": false,
      "properties": {
        "user_id": {
          "description": "User ID to get profile for",
          "type": "string"
        }
      },
      "required": [
        "user_id"
      ],
      "type": "object"
    },
    "GetProfileResponse": {
      "additionalProperties": false,
      "properties": {
        "user": {
          "$ref": "#/$defs/User",
          "description": "User profile data"
        }
      },
      "required": [
        "user"
      ],
      "type": "object"
    },
    "HistoryRequest": {
      "additionalProperties": false,
      "properties": {
        "cursor": {
          "description": "Pagination cursor (created_at of oldest message seen)",
          "type": "string"
        },
        "limit": {
          "description": "Maximum messages to return (default 50; max 100)",
          "maximum": 100,
          "minimum": 1,
          "type": "integer"
        },
        "room_id": {
          "description": "Room to fetch history for",
          "type": "string"
        }
      },
      "required": [
        "room_id"
      ],
      "type": "object"
    },
    "HistoryResponse": {
      "additionalProperties": false,
      "properties": {
        "has_more": {
          "description": "Whether older messages exist",
          "type": "boolean"
        },
        "messages": {
          "description": "Messages in chronological order (newest first)",
          "items": {
            "$ref": "#/$defs/Message"
          },
          "type": "array"
        },
        "next_cursor": {
          "description": "Pass as cursor to fetch older messages",
          "type": "string"
        }
      },
      "required": [
        "messages",
        "has_more",
        "next_cursor"
      ],
      "type": "object"
    },
    "InitRequest": {
      "additionalProperties": false,
      "properties": {},
      "type": "object"
    },
    "InitResponse": {
      "additionalProperties": false,
      "properties": {
        "current_room": {
          "description": "Room ID to display initially",
          "type": "string"
        },
        "dms": {
          "description": "DM rooms the user is a member of (sorted by most recent activity)",
          "items": {
            "$ref": "#/$defs/Room"
          },
          "type": "array"
        },
        "rooms": {
          "description": "Channel rooms the user is a member of",
          "items": {
            "$ref": "#/$defs/Room"
          },
          "type": "array"
        },
        "user": {
          "$ref": "#/$defs/User",
          "description": "The authenticated user"
        }
      },
      "required": [
        "user",
        "rooms",
        "dms",
        "current_room"
      ],
      "type": "object"
    },
    "JoinRoomRequest": {
      "additionalProperties": false,
      "properties": {
        "room_id": {
          "description": "Room ID to switch to",
          "type": "string"
        }
      },
      "required": [
        "room_id"
      ],
      "type": "object"
    },
    "JoinRoomResponse": {
      "additionalProperties": false,
      "properties": {
        "joined": {
          "description": "True if user was added as a new member (vs already being a member)",
          "type": "boolean"
        },
        "room": {
          "$ref": "#/$defs/Room",
          "description": "The room that was joined"
        }
      },
      "required": [
        "room",
        "joined"
      ],
      "type": "object"
    },
    "LeaveRoomRequest": {
      "additionalProperties": false,
      "properties": {
        "room_id": {
          "description": "Room ID to leave",
          "type": "string"
        }
      },
      "required": [
        "room_id"
      ],
      "type": "object"
    },
    "LeaveRoomResponse": {
      "additionalProperties": false,
      "properties": {
        "room_id": {
          "description": "Room ID that was left",
          "type": "string"
        }
      },
      "required": [
        "room_id"
      ],
      "type": "object"
    },
    "ListRoomsRequest": {
      "additionalProperties": false,
      "properties": {
        "query": {
          "description": "Optional search query to filter rooms by name",
          "type": "string"
        }
      },
      "type": "object"
    },
    "ListRoomsResponse": {
      "additionalProperties": false,
      "properties": {
        "is_member": {
          "description": "Whether the user is a member of each room (parallel array)",
          "items": {
            "type": "boolean"
          },
          "type": "array"
        },
        "rooms": {
          "description": "List of public rooms",
          "items": {
            "$ref": "#/$defs/Room"
          },
          "type": "array"
        }
      },
      "required": [
        "rooms",
        "is_member"
      ],
      "type": "object"
    },
    "ListUsersRequest": {
      "additionalProperties": false,
      "properties": {
        "query": {
          "description": "Search query for username (partial match)",
          "type": "string"
        }
      },
      "type": "object"
    },
    "ListUsersResponse": {
      "additionalProperties": false,
      "properties": {
        "users": {
          "description": "List of matching users",
          "items": {
            "$ref": "#/$defs/User"
          },
          "type": "array"
        }
      },
      "required": [
        "users"
      ],
      "type": "object"
    },
    "Message": {
      "additionalProperties": false,
      "properties": {
        "body": {
          "description": "Message content",
          "type": "string"
        },
        "created_at": {
          "description": "RFC3339Nano timestamp of creation",
          "type": "string"
        },
        "deleted_at": {
          "description": "RFC3339Nano timestamp of deletion (empty if not deleted)",
          "type": "string"
        },
        "id": {
          "description": "Unique message identifier (msg_ prefix)",
          "pattern": "^msg_[a-f0-9]{12}$",
          "type": "string"
        },
        "modified_at": {
          "description": "RFC3339Nano timestamp of last modification",
          "type": "string"
        },
        "reactions": {
          "description": "Aggregated emoji reactions on this message",
          "items": {
            "$ref": "#/$defs/Reaction"
          },
          "type": "array"
        },
        "room_id": {
          "description": "Room this message belongs to",
          "type": "string"
        },
        "user_id": {
          "description": "User who sent the message",
          "type": "string"
        },
        "username": {
          "description": "Username of sender (denormalized for convenience)",
          "type": "string"
        }
      },
      "required": [
        "id",
        "room_id",
        "user_id",
        "username",
        "body",
        "created_at",
        "modified_at"
      ],
      "type": "object"
    },
    "MessageDeleted": {
      "additionalProperties": false,
      "properties": {
        "message_id": {
          "description": "ID of the deleted message",
          "type": "string"
        },
        "room_id": {
          "description": "Room the message belongs to",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "room_id"
      ],
      "type": "object"
    },
    "MessageEdited": {
      "additionalProperties": false,
      "properties": {
        "body": {
          "description": "New message body",
          "type": "string"
        },
        "message_id": {
          "description": "ID of the edited message",
          "type": "string"
        },
        "modified_at": {
          "description": "RFC3339Nano timestamp of the edit",
          "type": "string"
        },
        "room_id": {
          "description": "Room the message belongs to",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "body",
        "room_id",
        "modified_at"
      ],
      "type": "object"
    },
    "Reaction": {
      "additionalProperties": false,
      "properties": {
        "count": {
          "description": "Number of users who reacted with this emoji",
          "type": "integer"
        },
        "emoji": {
          "description": "The emoji character(s)",
          "type": "string"
        },
        "user_ids": {
          "description": "IDs of users who reacted (for highlighting own reactions)",
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "required": [
        "emoji",
        "count",
        "user_ids"
      ],
      "type": "object"
    },
    "ReactionUpdated": {
      "additionalProperties": false,
      "properties": {
        "action": {
          "description": "Whether the reaction was added or removed",
          "enum": [
            "add",
            "remove"
          ],
          "type": "string"
        },
        "emoji": {
          "description": "The emoji character(s)",
          "type": "string"
        },
        "message_id": {
          "description": "ID of the message",
          "type": "string"
        },
        "room_id": {
          "description": "Room the message belongs to",
          "type": "string"
        },
        "user_id": {
          "description": "User who added/removed the reaction",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "room_id",
        "user_id",
        "emoji",
        "action"
      ],
      "type": "object"
    },
    "RemoveReactionRequest": {
      "additionalProperties": false,
      "properties": {
        "emoji": {
          "description": "Emoji character(s) to remove",
          "type": "string"
        },
        "message_id": {
          "description": "ID of the message to remove reaction from",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "emoji"
      ],
      "type": "object"
    },
    "Room": {
      "additionalProperties": false,
      "properties": {
        "id": {
          "description": "Unique room identifier (roo_ prefix)",
          "pattern": "^roo_[a-f0-9]{12}$",
          "type": "string"
        },
        "is_private": {
          "description": "Whether the room is private",
          "type": "boolean"
        },
        "members": {
          "description": "Room members (only populated for DMs)",
          "items": {
            "$ref": "#/$defs/RoomMember"
          },
          "type": "array"
        },
        "name": {
          "description": "Room display name (empty for DMs)",
          "type": "string"
        },
        "room_type": {
          "description": "Type of room: 'channel' or 'dm'",
          "enum": [
            "channel",
            "dm"
          ],
          "type": "string"
        }
      },
      "required": [
        "id",
        "name",
        "room_type",
        "is_private"
      ],
      "type": "object"
    },
    "RoomInfoRequest": {
      "additionalProperties": false,
      "properties": {
        "room_id": {
          "description": "Room ID to get info for",
          "type": "string"
        }
      },
      "required": [
        "room_id"
      ],
      "type": "object"
    },
    "RoomInfoResponse": {
      "additionalProperties": false,
      "properties": {
        "created_at": {
          "description": "RFC3339 timestamp of when the room was created",
          "type": "string"
        },
        "member_count": {
          "description": "Number of members in the room",
          "type": "integer"
        },
        "members": {
          "description": "List of room members",
          "items": {
            "$ref": "#/$defs/RoomMember"
          },
          "type": "array"
        },
        "room": {
          "$ref": "#/$defs/Room",
          "description": "Room details"
        }
      },
      "required": [
        "room",
        "member_count",
        "members",
        "created_at"
      ],
      "type": "object"
    },
    "RoomMember": {
      "additionalProperties": false,
      "properties": {
        "avatar": {
          "description": "Avatar URL (may be empty)",
          "type": "string"
        },
        "display_name": {
          "description": "Display name (may be empty)",
          "type": "string"
        },
        "id": {
          "description": "User ID",
          "type": "string"
        },
        "username": {
          "description": "Username",
          "type": "string"
        }
      },
      "required": [
        "id",
        "username"
      ],
      "type": "object"
    },
    "SearchRequest": {
      "additionalProperties": false,
      "properties": {
        "cursor": {
          "description": "Pagination cursor for next page",
          "type": "string"
        },
        "limit": {
          "description": "Max results to return (default 20)",
          "maximum": 100,
          "minimum": 1,
          "type": "integer"
        },
        "query": {
          "description": "Search query text",
          "minLength": 1,
          "type": "string"
        },
        "room_id": {
          "description": "Filter to specific room",
          "type": "string"
        },
        "user_id": {
          "description": "Filter to messages from specific user",
          "type": "string"
        }
      },
      "required": [
        "query"
      ],
      "type": "object"
    },
    "SearchResponse": {
      "additionalProperties": false,
      "properties": {
        "next_cursor": {
          "description": "Pagination cursor for next page",
          "type": "string"
        },
        "results": {
          "description": "Matching messages with snippets",
          "items": {
            "$ref": "#/$defs/SearchResult"
          },
          "type": "array"
        },
        "total": {
          "description": "Approximate total matches",
          "type": "integer"
        }
      },
      "required": [
        "results"
      ],
      "type": "object"
    },
    "SearchResult": {
      "additionalProperties": false,
      "properties": {
        "created_at": {
          "description": "RFC3339Nano timestamp of the message",
          "type": "string"
        },
        "message_id": {
          "description": "ID of the matching message",
          "type": "string"
        },
        "room_id": {
          "description": "Room the message belongs to",
          "type": "string"
        },
        "room_name": {
          "description": "Name of the room (for display)",
          "type": "string"
        },
        "snippet": {
          "description": "Message excerpt with **highlighted** matches",
          "type": "string"
        },
        "user_id": {
          "description": "Author of the message",
          "type": "string"
        },
        "username": {
          "description": "Username of the author",
          "type": "string"
        }
      },
      "required": [
        "message_id",
        "room_id",
        "room_name",
        "user_id",
        "username",
        "snippet",
        "created_at"
      ],
      "type": "object"
    },
    "SendMessageRequest": {
      "additionalProperties": false,
      "properties": {
        "body": {
          "description": "Message content",
          "minLength": 1,
          "type": "string"
        },
        "room_id": {
          "description": "Target room ID",
          "minLength": 1,
          "type": "string"
        }
      },
      "required": [
        "body",
        "room_id"
      ],
      "type": "object"
    },
    "UpdateProfileRequest": {
      "additionalProperties": false,
      "properties": {
        "display_name": {
          "description": "New display name (omit to keep current)",
          "type": "string"
        },
        "status": {
          "description": "New status message (omit to keep current)",
          "type": "string"
        }
      },
      "type": "object"
    },
    "UpdateProfileResponse": {
      "additionalProperties": false,
      "properties": {
        "user": {
          "$ref": "#/$defs/User",
          "description": "Updated user profile"
        }
      },
      "required": [
        "user"
      ],
      "type": "object"
    },
    "User": {
      "additionalProperties": false,
      "properties": {
        "avatar": {
          "description": "Avatar URL (may be empty)",
          "type": "string"
        },
        "display_name": {
          "description": "Display name (shown instead of username if set)",
          "type": "string"
        },
        "id": {
          "description": "Unique user identifier (usr_ prefix)",
          "pattern": "^usr_[a-f0-9]{16}$",
          "type": "string"
        },
        "status": {
          "description": "Custom status message",
          "type": "string"
        },
        "username": {
          "description": "Login username",
          "type": "string"
        }
      },
      "required": [
        "id",
        "username"
      ],
      "type": "object"
    }
  },
  "$id": "hatchat-protocol",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "anyOf": [
    {
      "$ref": "#/$defs/User"
    },
    {
      "$ref": "#/$defs/Room"
    },
    {
      "$ref": "#/$defs/Message"
    },
    {
      "$ref": "#/$defs/RoomMember"
    },
    {
      "$ref": "#/$defs/InitRequest"
    },
    {
      "$ref": "#/$defs/SendMessageRequest"
    },
    {
      "$ref": "#/$defs/HistoryRequest"
    },
    {
      "$ref": "#/$defs/JoinRoomRequest"
    },
    {
      "$ref": "#/$defs/CreateRoomRequest"
    },
    {
      "$ref": "#/$defs/CreateDMRequest"
    },
    {
      "$ref": "#/$defs/ListRoomsRequest"
    },
    {
      "$ref": "#/$defs/ListUsersRequest"
    },
    {
      "$ref": "#/$defs/LeaveRoomRequest"
    },
    {
      "$ref": "#/$defs/RoomInfoRequest"
    },
    {
      "$ref": "#/$defs/GetProfileRequest"
    },
    {
      "$ref": "#/$defs/UpdateProfileRequest"
    },
    {
      "$ref": "#/$defs/InitResponse"
    },
    {
      "$ref": "#/$defs/HistoryResponse"
    },
    {
      "$ref": "#/$defs/JoinRoomResponse"
    },
    {
      "$ref": "#/$defs/CreateRoomResponse"
    },
    {
      "$ref": "#/$defs/CreateDMResponse"
    },
    {
      "$ref": "#/$defs/ListRoomsResponse"
    },
    {
      "$ref": "#/$defs/ListUsersResponse"
    },
    {
      "$ref": "#/$defs/LeaveRoomResponse"
    },
    {
      "$ref": "#/$defs/RoomInfoResponse"
    },
    {
      "$ref": "#/$defs/GetProfileResponse"
    },
    {
      "$ref": "#/$defs/UpdateProfileResponse"
    },
    {
      "$ref": "#/$defs/ErrorResponse"
    },
    {
      "$ref": "#/$defs/Reaction"
    },
    {
      "$ref": "#/$defs/EditMessageRequest"
    },
    {
      "$ref": "#/$defs/DeleteMessageRequest"
    },
    {
      "$ref": "#/$defs/AddReactionRequest"
    },
    {
      "$ref": "#/$defs/RemoveReactionRequest"
    },
    {
      "$ref": "#/$defs/MessageEdited"
    },
    {
      "$ref": "#/$defs/MessageDeleted"
    },
    {
      "$ref": "#/$defs/ReactionUpdated"
    },
    {
      "$ref": "#/$defs/SearchRequest"
    },
    {
      "$ref": "#/$defs/SearchResponse"
    },
    {
      "$ref": "#/$defs/SearchResult"
    },
    {
      "$ref": "#/$defs/GetMessageContextRequest"
    },
    {
      "$ref": "#/$defs/GetMessageContextResponse"
    },
    {
      "$ref": "#/$defs/Envelope"
    }
  ],
  "description": "JSON Schema for all WebSocket messages in the Hatchat chat application",
  "title": "Hatchat WebSocket Protocol"
}
